<!DOCTYPE html>
<html>
<head>
    <title>Canvas Text Editor</title>
    <style>
        #canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="400" height="200"></canvas>
    <br>
    <label for="textInput">Text:</label>
    <input type="text" id="textInput" value="Enter text here">
    <br>
    <label for="textColor">Text Color:</label>
    <input type="color" id="textColor" value="#000000">
    <br>
    <label for="bgColor">Background Color:</label>
    <input type="color" id="bgColor" value="#ffffff">
    <br>
    <label for="textSize">Text Size:</label>
    
    
    <select id="textSize">
<option value="20">20</option>
<option value="50" selected>50</option>
<option value="70">70</option>
<option value="100">100</option>
<option value="100">130</option>
<option value="150">150</option>
<option value="200">200</option>
<option value="250">250</option>
<option value="300">300</option>
<option value="350">350</option>
<option value="400">400</option>
<option value="450">450</option>
<option value="500">500</option>
<option value="550">550</option>
<option value="600">600</option>
</select>  
    
    <br><br>
    <label for="fontFamily">Font:</label>
    <select id="fontFamily">
        <option value="Arial">Arial</option>
        <option value="Helvetica">Helvetica</option>
        <option value="Times New Roman">Times New Roman</option>
        <!-- Add more fonts as needed -->
    </select>

<br><br>
    <button onclick="downloadTextSection()">Download</button><br>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
var textInput = document.getElementById('textInput');
var textColor = document.getElementById('textColor');
var bgColor = document.getElementById('bgColor');
var textSize = document.getElementById('textSize');
var fontFamily = document.getElementById('fontFamily');

ctx.font = textSize.value + 'px ' + fontFamily.value;

function draw() {
    var lineHeight = textSize.value * 1.2;
    var y = lineHeight;
    var words = textInput.value.split(' ').reverse(); // Reverse words for RTL
    var line = '';
    var maxHeight = lineHeight;

    ctx.textAlign = 'right'; // Align text to the right

    for (var n = 0; n < words.length; n++) {
        var testLine = words[n] + ' ' + line; // Add new word to the beginning
        var metrics = ctx.measureText(testLine);
        var testWidth = metrics.width;
        if (testWidth > canvas.width - 20 && n > 0) { // 20px padding on right side
            line = words[n] + ' ';
            y += lineHeight;
            maxHeight = Math.max(maxHeight, y);
        } else {
            line = testLine;
        }
    }
    maxHeight = Math.max(maxHeight, y + lineHeight);

    canvas.height = maxHeight;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = bgColor.value;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = textColor.value;
    ctx.font = textSize.value + 'px ' + fontFamily.value;
    ctx.textAlign = 'right'; // Ensure text align is set after canvas is cleared

    y = lineHeight;
    line = '';
    for (var n = 0; n < words.length; n++) {
        var testLine = words[n] + ' ' + line;
        var metrics = ctx.measureText(testLine);
        var testWidth = metrics.width;
        if (testWidth > canvas.width - 20 && n > 0) { // 20px padding on right side
            ctx.fillText(line, canvas.width - 10, y); // 10px padding from right edge
            line = words[n] + ' ';
            y += lineHeight;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, canvas.width - 10, y); // 10px padding from right edge
}

function downloadTextSection() {
    var textBounds = getTextBounds();
    var tempCanvas = document.createElement('canvas');
    var tempCtx = tempCanvas.getContext('2d');
    
    tempCanvas.width = textBounds.width;
    tempCanvas.height = textBounds.height;
    
    tempCtx.fillStyle = bgColor.value;
    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
    
    tempCtx.drawImage(canvas, 
        textBounds.x, textBounds.y, textBounds.width, textBounds.height,
        0, 0, textBounds.width, textBounds.height
    );
    
    var link = document.createElement('a');
    link.download = 'text_section.png';
    link.href = tempCanvas.toDataURL();
    link.click();
}

function getTextBounds() {
    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    var data = imageData.data;
    var bounds = {
        left: canvas.width,
        right: 0,
        top: canvas.height,
        bottom: 0
    };

    for (var y = 0; y < canvas.height; y++) {
        for (var x = 0; x < canvas.width; x++) {
            var i = (y * canvas.width + x) * 4;
            if (data[i] !== parseInt(bgColor.value.slice(1, 3), 16) ||
                data[i+1] !== parseInt(bgColor.value.slice(3, 5), 16) ||
                data[i+2] !== parseInt(bgColor.value.slice(5, 7), 16)) {
                bounds.left = Math.min(x, bounds.left);
                bounds.right = Math.max(x, bounds.right);
                bounds.top = Math.min(y, bounds.top);
                bounds.bottom = Math.max(y, bounds.bottom);
            }
        }
    }

    // Add a small padding
    var padding = 5;
    bounds.left = Math.max(0, bounds.left - padding);
    bounds.top = Math.max(0, bounds.top - padding);
    bounds.right = Math.min(canvas.width - 1, bounds.right + padding);
    bounds.bottom = Math.min(canvas.height - 1, bounds.bottom + padding);

    return {
        x: bounds.left,
        y: bounds.top,
        width: bounds.right - bounds.left + 1,
        height: bounds.bottom - bounds.top + 1
    };
}

textInput.addEventListener('input', draw);
textColor.addEventListener('input', draw);
bgColor.addEventListener('input', draw);
textSize.addEventListener('input', draw);
fontFamily.addEventListener('input', draw);

draw();

</script>
</body>
</html>

